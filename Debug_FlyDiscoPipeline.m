%Debug_FlyBubblePipeline.m

modpath();


%% parameters
settingsdir = '/groups/branson/home/robiea/Code_versioned/FlyDiscoAnalysis/settings';

% analysis_protocol = '20210228_flybubble_dickson_locomotionGtACR1';
% analysis_protocol = '20210219_flybubble_dickson_nochrGtACR1testing'
% analysis_protocol = '20210219_flybubble_dickson_nochrGtACR1testing';
% analysis_protocol = 'current_non_olympiad_dickson_locomotionGtACR1_29_nonLED';
analysis_protocol = '20210219_flybubble_dickson_RGBGtACR1testing';

params = {'settingsdir',settingsdir,...
    'analysis_protocol',analysis_protocol, ...
    'forcecompute',true,...
    'doautomaticchecksincoming',true,...
    'doflytracking',true, ...
    'doregistration',true,...
    'doledonoffdetection',true,...
    'dosexclassification',true,...
    'dotrackwings',false,...
    'docomputeperframefeatures',true,...
    'docomputehoghofperframefeatures',false,...
    'dojaabadetect',false,...
    'docomputeperframestats',false,...
    'doplotperframestats',false,...
    'domakectraxresultsmovie',true,...
    'doextradiagnostics',false,...
    'doanalysisprotocol',isunix,...
    'doautomaticcheckscomplete',false};

%% experiment directory
% manually tracked by Alice 
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/locomotionGtACR1_24_EXT_VGLUT-GAL4_RigA_20210226T095136';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210301_calibration/socialCsChr_GMR_72C11_AE_01_CsChrimson_RigD_20191114T172654';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210301_calibration/nochr_TrpA71G01_Unknown_RigA_20201216T162938';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/runbypipeline/locomotionGtACR1_24_EXT_VGLUT-GAL4_RigA_20210226T095136';
%
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/FlyBubbleRGB/locomotionGtACR1_24_nonLED_JHS_K_85321_RigA_20210305T085013';
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/FlyBubbleRGB/locomotionGtACR1_29_nonLED_JHS_K_85321_RigA_20210227T113908';
% test regular registration mark on new insert/flybubble holder
% expdir  = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/20210309_testingsmallovalindicator/locomotionGtACR1_24_nonLED_JHS_K_85321_GtACR1_RigA_20210309T171438';
% updating optoregistration 
% expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/FlyBubbleRGB/locomotionGtACR1_24_RGB_EXT_VGLUT-GAL4_RigA_20210305T083721';
expdir = '/groups/branson/home/robiea/Projects_data/FlyDisco/Bubble_data/FlyBubbleRGB/locomotionGtACR1_29_RGB_EXT_VGLUT-GAL4_RigA_20210227T115122';
%% run
% for i = 1:numel(explist)
%     expdir = explist{i};
% [success,msgs,stage] = FlyBubblePipeline(expdir,params{:});
% end

[success,msgs,stage] = FlyDiscoPipeline(expdir,params{:});
